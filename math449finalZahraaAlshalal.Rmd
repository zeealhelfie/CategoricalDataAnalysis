---
title: "Math449 Final Exam"
author: "Zahraa Alshalal"
date: "2023-05-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```    

```{r}
library(DescTools)
library(tidyverse)
```


### Problem #1:

a.  Estimate of The proportion:

$$\pi = \frac{Total\ Regular\ Users}{Total\ Students}$$

```{r}
# Create the data matrix
data <- matrix(c(18, 7, 20, 5,
                 29, 13, 20, 8,
                 8, 13, 8, 6,
                 10, 5, 22, 11), ncol = 4, byrow = TRUE)

# Set the row and column names
rownames(data) <- c("Mathematics", "Computer Science", "Physics", "Chemistry")
colnames(data) <- c("Regular Male", "Regular Female", "Non-Regular Male", "Non-Regular Female")

# Convert the matrix to a data frame
data_df <- as.data.frame(data)

# Print the data frame
print(data_df)


```

```{r}
# Calculate row and column totals
row_totals = rowSums(data_table)
col_totals = colSums(data_table)

# Overall total
overall_total = sum(data_table)

# Initialize an empty matrix for expected counts
expected_table = matrix(nrow = nrow(data_table), ncol = ncol(data_table))

# Set the row and column names to match the observed data table
rownames(expected_table) = rownames(data_table)
colnames(expected_table) = colnames(data_table)

# Calculate expected counts for each cell
for (i in 1:nrow(expected_table)) {
  for (j in 1:ncol(expected_table)) {
    expected_table[i, j] = (row_totals[i] * col_totals[j]) / overall_total
  }
}

# Print the expected counts table
print(expected_table)

```


```{r}
# Proportions
proportions_table = data_table / total

# Proportions Table
print(proportions_table)

# Row Proportions
row_proportions = prop.table(data_table, margin = 1)
#print(row_proportions)

# Column Proportions
col_proportions = prop.table(data_table, margin = 2)
#print(col_proportions)

```

```{r}
# Sum of regular users (males and females)
regular_users = sum(data_table[, "Regular Male"], data_table[, "Regular Female"])

# Total number of students
total_students = sum(data_table)

# Estimate of pi
pi_estimate = regular_users / total_students

# the estimate
formatted_pi_estimate = sprintf("%.2f", pi_estimate)
print(paste("The estimate of pi is", formatted_pi_estimate))

```    

-   According to the data, the estimate of 𝜋, the proportion of students who regularly use the library, is approximately 0.51, indicating that about 51% of the surveyed students use the library regularly.    
    
b.       
+ chi-squared test of independence is used to test for association between department and library use while ignoring the sex of respondents. This test evaluates whether the observed frequencies in the contingency table (department vs. library use) differ significantly from the expected frequencies under the assumption of independence.     

+ One conditions chi-squared test is that the expected frequency for each cell should ideally be greater than 5. All expected frequencies are well above 5, so this assumption is met as well.

$H_0$: There is no association between the department and library use.
$H_a$: There is an association between the department and library use.    

```{r}
# Perform chi-squared test of independence
result = chisq.test(data_table)

# Print the test result
print(result)
```    

+ The p-value (0.01027) is less than the significance level (alpha = 0.05). Reject the null hypothesis of independence. Based on the chi-squared test result, we can conclude that there is a statistically significant association between department and library use in the given data.     

c.    
    
```{r}
# Sum of male and female regular users
male_regular_users <- sum(data_table[, "Regular Male"])
female_regular_users <- sum(data_table[, "Regular Female"])

# Total number of male and female students
total_male_students <- sum(data_table[, c("Regular Male", "Non-Regular Male")])
total_female_students <- sum(data_table[, c("Regular Female", "Non-Regular Female")])

# Use prop.test() to calculate 97% confidence interval
test_result <- prop.test(c(male_regular_users, female_regular_users), 
                         c(total_male_students, total_female_students),
                         conf.level = 0.97)

# Extract the lower and upper bounds of the confidence interval
lower_bound <- test_result$conf.int[1]
upper_bound <- test_result$conf.int[2]

# Print the 97% confidence interval
cat("Approximate 97% Confidence Interval:")
cat("\n")
cat("-------------------------------")
cat("\n")
cat("Difference in Proportions: ", round(test_result$estimate[1] - test_result$estimate[2], 4))
cat("\n")
cat("95% Confidence Interval: [", round(lower_bound, 4), ",", round(upper_bound, 4), "]")
cat("\n")
cat("-------------------------------")

```    
+ This interval suggests that the true difference in proportions between males and females who regularly use the library could range from -0.249 to 0.0943 with 97% confidence. Since the interval includes zero, we cannot conclude with certainty that there is a significant difference between the proportions.     
    
d.    
```{r}
# initialize an empty dataframe
expanded_data <- data.frame()

# Loop through every department and gender/usage combination
for(i in 1:nrow(data_df)) {
  for(j in 1:ncol(data_df)) {
    usage_gender <- strsplit(colnames(data_df)[j], " ")
    df <- data.frame(
      Department = rownames(data_df)[i],
      Usage = usage_gender[[1]][1],
      Gender = usage_gender[[1]][2]
    )
    expanded_data <- rbind(expanded_data, df[rep(1:nrow(df), data_df[i, j]), ])
  }
}

# Convert the 'Usage' column to binary (1 for "Regular" and 0 for "Non-Regular")
expanded_data$Usage <- ifelse(expanded_data$Usage == "Regular", 1, 0)

# Fit the model
model <- glm(Usage ~ Department + Gender, data = expanded_data, family = "binomial")

# Check the model summary
summary(model)

```    

```{r}
str(expanded_data)

```





